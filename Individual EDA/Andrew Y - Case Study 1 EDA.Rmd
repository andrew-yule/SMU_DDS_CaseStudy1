---
title: "Andrew Y - Case Study 1 EDA"
author: "Andrew Yule"
date: '`r Sys.Date()`'
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=TRUE, echo=TRUE, results='hide', error=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(maps)
library(gridExtra)
library(lubridate)
library(GGally)
library(jsonlite)
library(class)
library(caret)
library(e1071)
```

# Exploratory data analysis (EDA)
## Data import
### Import the beers and breweries data sets
```{r include=TRUE, echo=TRUE, results='hide', error=FALSE, warning=FALSE, message=FALSE}
beers = read_csv("/Users/andrewyule/Dropbox/Personal/SMU MSDS/03 - Doing Data Science/SMU_DDS_CaseStudy1/Data/Beers.csv")
breweries = read_csv("/Users/andrewyule/Dropbox/Personal/SMU MSDS/03 - Doing Data Science/SMU_DDS_CaseStudy1/Data/Breweries.csv")
```

## Analysis questions
### 1. How many breweries are present in each state?
In the data, Colorado was found to have the most number of breweries from the data set (47), followed by California (39), Michigan (32), Oregon (29), and Texas (28). The lowest counted number of breweries was 1, which was found in Washington DC, North Dakota, South Dakota and West Virigina.
```{r include=TRUE, echo=TRUE, error=FALSE, message=FALSE, warning=FALSE}
breweryCount = breweries |> count(State)
stateAbbreviations = tibble(abb = state.abb, name = tolower(state.name))
breweryCount = left_join(breweryCount, stateAbbreviations, by = c("State" = "abb"))

states = as_tibble(map_data("state"))
breweryCount = left_join(states, breweryCount, by = c("region" = "name"))
ggplot(breweryCount, aes(x = long, y = lat, group = group))+
  geom_polygon(aes(fill = n))+
  geom_path() + 
  scale_fill_gradientn(colours = rev(heat.colors(10)), na.value = "grey90") +
  coord_map() +
  labs(x = NULL, y = NULL, title = "Number of Breweries Found Across Each State") +
  theme_void()
```

### 2. Merge the beers and breweries data sets to create a single data set containing both beer information as well as brewery
```{r include=TRUE, echo=TRUE, error=FALSE, message=FALSE, warning=FALSE}
beers = left_join(beers, breweries, by = c("Brewery_id" = "Brew_ID")) |>
  rename(Beer = Name.x) |>
  rename(Brewery = Name.y)

beers |> head(n = 6)
beers |> tail(n = 6)
```


### 3. Address the missing values in each column.
The only columns from the data set containing missing entries are ABV (alcohol by volume), IBU (international bitterness units), and Style. The highest number of missing values was found for the IBU variable (42% of values are missing).
```{r include=TRUE, echo=TRUE, error=FALSE, message=FALSE, warning=FALSE}
(colSums(is.na(beers))/dim(beers)[1])*100
```

### 4. / 5. Compute the median alcohol content and international bitterness unit for each state. Plot a bar chart to compare. Which state has the maximum alcoholic (ABV) beer? Which state has the most bitter (IBU) beer?
The median alcohol by volume (ABV) across the states varies between 0.04 (Utah) and 0.0625 (Washington DC & Kentucky).
The median international bitterness unit (IBU) varies between 19 (Wisconsin) and 61 (Maine).
```{r include=TRUE, echo=TRUE, error=FALSE, message=FALSE, warning=FALSE}
medianABV = beers |>
  filter(!is.na(ABV)) |>
  group_by(State) |>
  summarize(ABV = median(ABV))

medianIBU = beers |>
  filter(!is.na(IBU)) |>
  group_by(State) |>
  summarize(IBU = median(IBU))

p1 = medianABV |>
  ggplot(aes(y = reorder(State, ABV), x = ABV)) +
  geom_col() +
  labs(x = "Median ABV", y = NULL, title = "Median Alcohol by Volume Across States")

p2 = medianIBU |>
  ggplot(aes(y = reorder(State, IBU), x = IBU)) +
  geom_col() +
  labs(x = "Median IBU", y = NULL, title = "Median International Bitterness Unit Across States")

grid.arrange(p1, p2)
```

### 6. Comment on the summary statistics and distribution of the ABV variable.
Overall, the average ABV is around 0.059, with a minimum and maximum reported value of 0.001 and 0.128 respectively. The distribution of ABV is right skewed, meaning there are a few beers with very high alcohol contents increasing the mean ABV compared to the median ABV.
```{r include=TRUE, echo=TRUE, error=FALSE, message=FALSE, warning=FALSE}
beers |> 
  select(ABV) |>
  summary()

beers |> 
  ggplot(aes(x = ABV)) +
  geom_histogram()
```

### 7. Is there an apparent relationship between the bitterness of the beer and its alcoholic content? Draw a scatter plot.  Make your best judgment of a relationship and EXPLAIN your answer.
The scatterplot between IBU and ABV shows that there is a positive correlation (0.67), meaning that as IBU increases, it is expected that ABV increases as well.
```{r include=TRUE, echo=TRUE, error=FALSE, message=FALSE, warning=FALSE}
cor(beers[!is.na(beers$ABV) & !is.na(beers$IBU),]$IBU, beers[!is.na(beers$ABV) & !is.na(beers$IBU),]$ABV)

beers |>
  ggplot(aes(x = IBU, y = ABV)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(x = "IBU", y = "ABV", title = "Relationship between IBU and ABV")
```








